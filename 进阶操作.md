# 人机验证的处理方式

+ 在多次点击水井后，会触发人机验证的弹窗，是一个12块的拼图，有四个拼图的位置不对，并且错误的形式为两两互换，不存在交叉的情况。还有一个机制是，当你交换的操作正确时，才会执行交换。

+ 前人的处理方法：有的脚本无法处理人机验证，本项目参考的那个项目是把拼好的拼图存在本地，然后用图像识别的方法，将散乱的拼图块复位。这样的方法的缺点是：其一，每个拼图块本来就小并且比较相似，图像识别有可能不成功；其二，游戏方是会更换拼图的图片的，所以该脚本只能定期更新拼好的拼图，比较麻烦。

+ 基于游戏本身的机制和前辈的提示，我们可以用以下枚举的方法，破解这个人机验证。选择两个拼图块A和B,A为第一块到最后一块，B为A的后面一块到最后一块，依次遍历并交换。每次交换后检测人机验证是否结束，及时break。

+ 如果你学过算法设计与分析，就会发现这个步骤就是选择排序。

# 消除行人对于此脚本的扰动
+ 在前辈的版本中也并没有这个处理，应该是因为一年前的游戏内容不同吧。如果在点击过程中点到行人，分两种情况：如果是普通居民，那么该行人会使本次点击失效；如果是有特殊效果的行人，则会触发一个弹窗。我的处理方法是：点击水井后，经过短暂延时，截屏，将图片和本地预留的图片（本应该进入的页面截图）相比对，如果匹配成功，则会继续进行；否则就先点击空白处（该空白处选取为地图中的河流，不可能有行人干扰导致点击失败）退出，然后再次点击水井，重复以上操作，直到匹配成功。

# 异常情况的处理
+ 虽然此脚本可以运行非常长的时间，但还是会存在一些未知情况（比如其他软件的弹窗被误点），因此当重复两次点击同一个水井依然失败时，会跳过这个水井（比如有人一直站在这个水井上），接着点击下一个水井，此过程会看作一次“失败”。当每一轮结束后，如果失败的次数大于总次数的二分之一（正常情况时不会大于这个数的），则会终止脚本，因为这种情况说明手机画面已经偏离脚本的本意了。
+ 因为判断是否为拼图界面，有可能会把特殊行人弹窗识别为拼图（因为弹窗千奇百怪，而代码中匹配度不能设置太高，否则真的拼图页面也识别不出来），此时解拼图自然会失败，会终止程序。不过参数经过调整，暂时还没有再次出现这样的情况。